<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>博客</title>
    <link rel="stylesheet" th:href="@{/css/oksub.css}">
    <link rel="stylesheet" th:href="@{/lib/iview/styles/iview.css}">
    <link rel="stylesheet" th:href="@{/lib/EditorMD/css/editormd.min.css}" />
</head>
<body>
<div id="app" class="ok-body" v-cloak>
    <template>
        <div style="margin-bottom:10px">
            <i-input placeholder="爬取地址"  v-model="blog.url"  style="width: 80%"></i-input>
            <i-button type="primary"  icon="ios-search" @click="crawl()">抓取</i-button>
        </div>
    </template>
    <template>
        <i-input placeholder="类型"  v-model="blog.category"  style="width: 10%"></i-input>
        <i-input placeholder="标题"  v-model="blog.title"  style="width: 60%"></i-input>
    </template>
    <div id="editormd" style="margin-top:10px">
        <textarea style="display:none;">

        </textarea>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" th:src="@{/lib/EditorMD/js/editormd.min.js}"></script>
<script type="text/javascript" th:src="@{/lib/EditorMD/js/uploadImg.js}"></script>
<script type="text/javascript" th:src="@{/lib/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/lib/vue/vue.min.js}" ></script>
<script type="text/javascript" th:src="@{/lib/iview/iview.min.js}"></script>
<script type="text/javascript">
var vm = new Vue({
    el: '#app',
    data:{
        blog:{},
        okUtils:null,
        okLayer:null,
        action:''
    },
    methods: {
         acceptClick : function(dialog){
             vm.blog.content = editor.getMarkdown();
             vm.okUtils.ajaxCloud({
                url:"/blog/posts/save",
                json:true,
                param : vm.blog,
                success : function(result) {
                     vm.okLayer.msg.greenTick(result.msg, function () {
                          dialog.load();
                     })
                }
            });
         },
         crawl:function(){
             layui.use(["okUtils", "okLayer"], function () {
                 vm.okUtils = layui.okUtils;
                 vm.okLayer = layui.okLayer;
                 vm.okUtils.ajaxCloud({
                    url:"/blog/posts/crawl",
                    close: false,
                    param : {url:vm.blog.url},
                    success : function(result) {
                        vm.blog = result.msg;
                        vm.load();
                    }
                });
             });
         },
         load:function(){
            editor.setMarkdown(vm.blog.content);
         }
    },
    created: function() {

    }
})
var editor;
$(function() {
    show()
});
function show(){
    editor = editormd("editormd", {
         width  : "100%",
         height : "450px",
         saveHTMLToTextarea : true,
         imageUpload : true,
         imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
         imageUploadURL : "/app/article/upload",
         onload: function () {
            initPasteDragImg(this);
         },
         path : "/lib/EditorMD/lib/"
    });
}
</script>
</body>
</html>
